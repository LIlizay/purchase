<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>网上营业厅</title>
		<link href="assets/css/bootstrap.css" rel="stylesheet" />
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <link href="assets/css/custom-styles.css" rel="stylesheet" />
	</head>
	<body>
		<div class="mask"></div>
		<div id="wrapper">
        <nav class="navbar navbar-default top-navbar" role="navigation">
           <div class="navbar-header">
    			<a class="navbar-brand" href="javascript:void(0)" onClick="clickMenu('index')"><span class="logo-pp"><img src="images/logo.png" style="width:20px;"/></span>网上营业厅</a> </div>
            <div class="navbar-header btn-pp">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="icon-bar fa icon-iconfontcaidan fa-2x" style="color:#fff;"></span>
                </button> 
            </div>
            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown border-right">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)" aria-expanded="false">
                        <i class="fa icon-xiaoxitongzhi fa-fw"></i>
                        <i class="topbar-num"></i>
                        <i class="fa icon-xiaosanjiaodown fa-x"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)" aria-expanded="false">
                        <i class="fa icon-user fa-fw fa-x"></i> <i class="fa icon-xiaosanjiaodown fa-x"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="javascript:void(0)" onClick="clickMenu('my-information')"><i class="fa icon-user fa-fw"></i> 档案信息</a>
                        </li>
                        <li><a href="javascript:void(0)" onClick="clickMenu('modify-password')"><i class="fa icon-shezhi fa-fw"></i>密码修改</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="javascript:void(0)" onClick="loginOut()"><i class="fa icon-tuichu fa-fw"></i> 退出</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
        </nav>
        <!--/. NAV TOP  -->
        <nav class="navbar-default navbar-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">
                    <li>
                        <a class="" href="javascript:void(0)" onClick="clickMenu('index')" id="indexMenu"><i class="fa icon-home"></i> 我的主页</a>
                    </li>
                    <li>
                        <a href="javascript:void(0)"><i class="fa icon-information"></i> 我的信息<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('my-information')" id="my-informationMenu"><i class="fa icon-yousanjiao"></i>档案信息</a>
                            </li>
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('modify-password')" id="modify-passwordMenu"><i class="fa icon-yousanjiao"></i>密码修改</a>
                            </li>
						</ul>
                    </li>
					<li>
                        <a href="javascript:void(0)"><i class="fa icon-hetong"></i> 我的合同<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('agreement')" id="agreementMenu"><i class="fa icon-yousanjiao"></i>合同查询</a>
                            </li>
                            
						</ul>  
                    </li>
                    <li>
                        <a href="javascript:void(0)"><i class="fa icon-jiaoyi"></i> 我的交易<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('smpurchasemonth-list')" id="smpurchasemonth-listMenu"><i class="fa icon-yousanjiao"></i>月度购电电量预测查询</a>
                              </li>
                            <li>
                                <a href="javascript:void(0)"><i class="fa icon-yousanjiao"></i>月度委托电量申报<span class="fa arrow"></span></a>
                                  <ul class="nav nav-third-level">
                                    <li>
                                        <a href="javascript:void(0)" onClick="clickMenu('transaction')" id="transactionMenu"><i class="fa icon-dian"></i>委托电量申报查询</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" onClick="clickMenu('transaction-add')" id="transaction-addMenu"><i class="fa icon-dian"></i>委托电量申报</a>
                                    </li>
                                  </ul>
                            </li>
                            <li>
                                <a href="javascript:void(0)"><i class="fa icon-yousanjiao"></i>用电情况上报<span class="fa arrow"></span></a>
                                <ul class="nav nav-third-level">
                                    <li>
                                        <a href="javascript:void(0)" onClick="clickMenu('reportpq-list')" id="reportpq-listMenu"><i class="fa icon-dian"></i>用电情况上报查询</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0)" onClick="clickMenu('reportpq-add')" id="reportpq-addMenu"><i class="fa icon-dian"></i>用电情况上报</a>
                                    </li>
                                </ul>

                            </li>
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('devwarn-list')" id="devwarn-listMenu"><i class="fa icon-yousanjiao"></i>偏差预警信息查询</a>
                                
                            </li>
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('deviation-calculate')" id="deviation-calculateMenu"><i class="fa icon-yousanjiao"></i>偏差考核费用试算</a>
                            </li>
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('elec-info')" id="elec-infoMenu"><i class="fa icon-yousanjiao"></i>用电信息查询</a>
                            </li>
                        </ul>
                    </li>
                    
                    <li>
                        <a href="javascript:void(0)"><i class="fa icon-jiesuan"></i> 我的结算<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('amt-calculate')" id="amt-calculateMenu"><i class="fa icon-yousanjiao"></i>电费试算</a>
                            </li>
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('elec-bill')" id="elec-billMenu"><i class="fa icon-yousanjiao"></i>电费查询</a>
                            </li>
                        </ul>
					</li>
               		<li>
               			<a href="javascript:void(0)"><i class="fa icon-xiaoxitongzhi"></i> 我的消息 <span class="fa arrow"></span></a>
               			<ul class="nav nav-second-level">
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('todo')" id="todoMenu"><i class="fa icon-yousanjiao"></i>我的待办</a>
                            </li>
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('finish')" id="finishMenu"><i class="fa icon-yousanjiao"></i>我的已办</a>
                            </li>
                            <li>
                                <a href="javascript:void(0)" onClick="clickMenu('notice-message')" id="notice-messageMenu"><i class="fa icon-yousanjiao"></i>公告信息</a>
                            </li>
                        </ul>
               		</li>
                </ul>

            </div>

        </nav>
        <div id="page-wrapper">
            <div id="page-inner">
				<iframe src="" frameborder="0" marginheight="0" marginwidth="0" 
					frameborder="0" scrolling="no" id="iframe" name="ifm" height="100%" width="100%" style="margin:0px" 
					allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe>
            </div>
        </div>
    </div>
    <script src="assets/js/jquery-1.10.2.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery.metisMenu.js"></script>
     <script src="assets/js/base.js"></script>
     <script src="assets/js/jquery.json-2.2.js"></script>
   <!--  <script src="assets/js/morris/raphael-2.1.0.min.js"></script>
    <script src="assets/js/morris/morris.js"></script> -->
    <script src="assets/js/custom.js"></script>
    <script src="assets/js/custom-scripts.js"></script>
    <script type="text/javascript">
    $(function(){
		//设置页面的高度
		$.initpageCss(); 
		//设置页面跳转
		$.initIframe();
		//查询首页的偏差预警信息
		initdevData();
	});	
    
    //点击菜单
    function clickMenu(index){
		var url = encodeURI(basePath+"?local="+index+"&consId="+loginObject.consId+"&loginName="+loginObject.loginName+"&userName="+loginObject.userName+"&org_id="+loginObject.org_id);
		window.location.href = url;
    }
    //退出
    function loginOut(){
    	window.location.href = topUrl;
    }
 	 //查询首页的偏差预警信息
	function initdevData(){
		var queryParams = {
	    		serviceKey:"c_getConsWaringList",
	    		clientKey:"sellandpurchase",
	    		params:{
	    		    consId:$.getLoginUser().consId,
	    		    consName:"",
	    			ym:"",
	    			status:"01",
	    			compStatus:"",
	    			org_id:"",
	    			index:0,
	    			pageSize:5,
	    		 }
	    	};
		$.ajax({
			url : groovyPath + "c_getConsWaringList.do",
			type : "post",
			data:$.toJSON(queryParams),
	        contentType:'application/json;charset=UTF-8', 
			success : function(data) {
				if(!data.message){
					var cont = data.value.datas;
					//设置条数
					$(".dropdown").first().find(".topbar-num").html(cont.length);
					if(cont && cont.length > 0){
						//设置信息
						var html = "<li style='text-align:right;'><a onclick='changeMsgSattus()' href='javascript:void(0)' style='color: #00C1DE;font-size: 12px;font-weight: bold;'>全部设置为已读</a></li>";
						for(var i in cont){
							str = cont[i].warningDate.substring(0,4)+"年"+parseInt(cont[i].warningDate.substring(5,7))+"月"+parseInt(cont[i].warningDate.substring(8,10))+"日"
							+"产生"+cont[i].warningTypeName+cont[i].deviationPq+"兆瓦时"+cont[i].warningGradeName;
							html += "<li> <a href='javascript:void(0)' onclick=\"detail('"+cont[i].deviationId+"')\"><div>"
							+"<i class='fa icon-dian fa-fw'></i> <span class='text-w160' style='width:310px;font-size:12px;'>" + str + "</span>"
							+"</div> </a></li><li class='divider'></li>";
						}
						html += " <li><a class='text-center' href='javascript:void(0)' onclick='clickMenu(\"devwarn-list\")'><strong>查看更多<i class='fa icon-gengduo'></i></strong>"
						+"<i class='fa fa-angle-right'></i></a> </li>";
						$(".dropdown").first().find(".dropdown-menu").empty().append(html);
					}else{
						$(".dropdown").first().find(".dropdown-menu").empty();
					}
				}else{
					MainFrameUtil.alert({title: "失败提示",body:"查询失败！"});
		      		return;
				}
			},
			error : function() {
				MainFrameUtil.alert({title: "网络失败提示",body:"请刷新页面重试！"});
	      		return;
			}
		})
	}	
 	 
	//详情
    function detail(id){
    	MainFrameUtil.openDialog({
	 		id:"devwarn_detail",
			params:{id:id},
			herf:"devwarn-detail.html",
			maximizable:false,
			width:"90%",
			height:430,
			onClose:function(){
				//查询主页信息
				initdevData(); 
			}
	  	  });
    }
	
	//更新消息状态
	function changeMsgSattus(){
		var queryParams = {
	    		serviceKey:"c_updateConsAllWarnStatus",
	    		clientKey:"sellandpurchase",
	    		params:{
	    		    consId:$.getLoginUser().consId,
	    		 }
	    	};
		$.ajax({
			url : groovyPath + "c_updateConsAllWarnStatus.do",
			type : "post",
			data:$.toJSON(queryParams),
	        contentType:'application/json;charset=UTF-8', 
			success : function(data) {
				if(!data.message){
					//更新成功
					initdevData();
					MainFrameUtil.alert({title: "成功提示",body:"已全部设置为已读状态！"});
		      		return;
				}else{
					MainFrameUtil.alert({title: "失败提示",body:"更新状态失败！"});
		      		return;
				}
			},
			error : function() {
				MainFrameUtil.alert({title: "网络失败提示",body:"请刷新页面重试！"});
	      		return;
			}
		})
	}
    </script>
	</body>
</html>
