<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link href="assets/css/bootstrap.css" rel="stylesheet" />
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <link href="assets/css/custom-styles.css" rel="stylesheet" />
	</head>
	<body>
		<div class="row">
			<div class="col-md-12">
			    <div class="panel panel-default">
					<div class="panel-heading">
						<span class="line-box"></span>档案信息
					</div>
                 	<div class="panel-body">
                 		<div class="table-responsive">
                           <table class="table table-striped table-bordered table-hover">
                               <thead>
                                   <tr>
                                       <th colspan="6" class="bg-info">用户基本信息</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   <tr>
                                       <td class="text-right w-1st"><span class="f-red">* </span>用户名称 :</td>
                                       <td class="w-7th" id="consName"></td>
                                       <td class="text-right w-1st"><span class="f-red">* </span>用户类型 :</td>
                                       <td class="w-7th" id="consTypeName"></td>
                                        <td class="text-right w-1st">公示序列号 :</td>
                                       <td class="w-8th" id="dealSeq"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right"><span class="f-red">* </span>用电行业分类 :</td>
                                       <td id="industryTypeName"></td>
                                       <td class="text-right">所属供电公司 : </td>
                                       <td id="orgName"></td>
                                       <td class="text-right">所属园区 :</td>
                                       <td id="industrialZoneName"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right"><span class="f-red">* </span>省  :</td>
                                       <td id="provinceCodeName"></td>
                                       <td class="text-right"><span class="f-red">* </span>市 :</td>
                                       <td id="cityCodeName"></td>
                                       <td class="text-right"><span class="f-red">* </span>区/县 :</td>
                                       <td id="countyCodeName"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">是否完成信息采集 :</td>
                                       <td id="scadaFlagName"></td>
                                      <td class="text-right">市场状态 :</td>
                                       <td id="marketStatusName"></td>
                                       <td class="text-right">是否直购电用户 :</td>
                                       <td id="directPowerName"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">用电地址 :</td>
                                       <td colspan="5" id="elecAddr"></td>
                                   </tr>
                               </tbody>
                           </table>
                           <table class="table table-striped table-bordered table-hover">
                               <thead>
                                   <tr>
                                       <th colspan="6" class="bg-info">用电信息 :</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   <tr>
                                        <td class="text-right w-4th"><span class="f-red">* </span>用电容量(kVA) :</td>
                                       <td class="w-10th" id="electricCapacity"></td>
                                        <td class="text-right w-4th"><span class="f-red">* </span>用电类别 :</td>
                                       <td class="w-10th" id="elecTypeCodeName"></td>
                                   </tr>
                                   <tr>
                                   	 <td class="text-right"><span class="f-red">* </span>电压等级 :</td>
                                       <td id="voltCodeName"></td>
                                       <td class="text-right">安排年度上限 :</td>
                                       <td id="upperPq"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">负荷性质 :</td>
                                       <td id="lodeAttrCodeName"></td>
                                       <td class="text-right"></td>
                                       <td></td>
                                   </tr>
                               </tbody>
                           </table>
                           <table class="table table-striped table-bordered table-hover" style="text-align: center;">
                               <thead>
                                   <tr>
                                       <th colspan="6" class="bg-info">计量点信息</th>
                                   </tr>
                               </thead>
                               <tbody id="mpinfo">
                                   <tr>
                                       <td style="width:18%;">营销户号</td>	
                                       <td style="width:18%;">计量点编号</td>
                                       <td style="width:18%;">计量名称</td>
                                       <td style="width:18%;">电能表编号</td>
                                       <td style="width:18%;">电能表倍率</td>
                                       <td style="width:9%;">电能表位数</td>
                                   </tr>
                               </tbody>
                           </table>
                           <table class="table table-striped table-bordered table-hover">
                               <thead>
                                   <tr>
                                       <th colspan="6" class="bg-info">商务信息</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   <tr>
                                       <td class="text-right w-4th">营业执照注册号 :</td>
                                       <td class="w-10th" id="registrationNo"></td>
                                       <td class="text-right w-4th">税务登记证号 :</td>
                                       <td class="w-10th" id="vatNo"></td>
                                   </tr>
                                   <tr>
                                   		<td class="text-right">组织机构代码 :</td>
                                       <td id="orgCode"></td>
                                       <td class="text-right">法人名称 :</td>
                                       <td id="legalAgent"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">法人代表名称 :</td>
                                       <td id="authAgent"></td>
                                       <td class="text-right">企业注册地址 :</td>
                                       <td id="registeredAddress"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">开户银行 :</td>
                                       <td id="bankName"></td>
                                       <td class="text-right">开户名称 :</td>
                                       <td id="countName"></td>
                                   </tr>
                                   <tr>
                                   		<td class="text-right">开户账号 :</td>
                                       <td id="countNo"></td>
                                       <td class="text-right"></td>
                                       <td></td>
                                   </tr>
                               </tbody>
                           </table>
                           <table class="table table-striped table-bordered table-hover">
                               <thead>
                                   <tr>
                                       <th colspan="6" class="bg-info">联系人信息</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   <tr>
                                       <td class="text-right w-4th">联系人姓名 :</td>
                                       <td class="w-10th" id="contName"></td>
                                       <td class="text-right w-4th">职务 :</td>
                                       <td class="w-10th" id="post"></td>
                                   </tr>
                                   <tr>
                                   		<td class="text-right">手机号 :</td>
                                       <td id="phone"></td>
                                        <td class="text-right">办公电话 :</td>
                                       <td id="officePhone"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">传真号 :</td>
                                       <td id="fax"></td>
                                       <td class="text-right">电子邮箱 : </td>
                                       <td id="eMail"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">通信地址 :</td>
                                       <td id="addr"></td>
                                       <td class="text-right">邮政编码 :</td>
                                       <td id="postcode"></td>
                                   </tr>
                               </tbody>
                           </table>
                           <table class="table table-striped table-bordered table-hover">
                               <thead>
                                   <tr>
                                       <th colspan="6" class="bg-info">售电公司服务人员信息</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   <tr>
                                       <td class="text-right w-4th">客户经理姓名 : </td>
                                       <td class="w-10th" id="sellPerson"></td>
                                       <td class="text-right w-4th">职务 :</td>
                                       <td class="w-10th" id="sellPost"></td>
                                   </tr>
                                   <tr>
                                   		<td class="text-right">手机号 :</td>
                                       <td id="sellPhone"></td>
                                       <td class="text-right">办公电话 :</td>
                                       <td id="sellOfficePhone"></td>
                                   </tr>
                                   <tr>
                                       <td class="text-right">传真号 :</td>
                                       <td id="sellFaxNo"></td>
                                       <td class="text-right">电子邮箱 :</td>
                                       <td id="sellEMail"></td>
                                   </tr>
                               </tbody>
                           </table>
                           <table class="consRelaMessage table table-striped table-bordered table-hover" style="text-align:center;">
                               <thead>
                                   <tr>
                                       <th colspan="6" class="bg-info">添加上级单位</th>
                                   </tr>
                               </thead>
                               <tbody id="consrela">
                                   <tr>
                                       <td style="width:4%;">序号</td>
                                       <td style="width:28%;">关联用户名称</td>
                                       <td style="width:28%;">电压等级</td>
                                       <td style="width:28%;">用电类别</td>
                                       <td style="width:12%;">详细信息</td>
                                   </tr>
                               </tbody>
                           </table>
                       </div>
                 	</div>
				</div>
			</div>						
		</div>
		<script src="assets/js/jquery-1.10.2.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery.metisMenu.js"></script>
     <script src="assets/js/base.js"></script>
     <script src="assets/js/jquery.json-2.2.js"></script>
   <!--  <script src="assets/js/morris/raphael-2.1.0.min.js"></script>
    <script src="assets/js/morris/morris.js"></script> -->
    <script src="assets/js/custom.js"></script>
    <script src="assets/js/custom-scripts.js"></script>
    <script type="text/javascript">
    var consId = window.parent.parent.loginObject.consId;
	    $(function(){
	    	//设置页面的高度
	    	$.initpageCss();
	    	$(window).resize(function(){
	    		$.initpageCss();
	    	});
	    	//初始化数据
	    	initData();
	    });
	
	    function initData(){
	    	var obj;
	    	var mplist = [];
	    	var relalist = [];
	    	var queryParams = {
	    			serviceKey:"sw_getConsInfo",
	    			clientKey:"sellandpurchase",
	    			params:{consId : consId}
	    	};
	    	$.ajax({
	    		url :  groovyPath + "sw_getConsInfo.do",
	    		type : "post",
	    		data:$.toJSON(queryParams),
	            contentType:'application/json;charset=UTF-8',  
	    		success:function(data){
	    			if(!data.message){
	    				if(data.value.datas != null){
		    				if(data.value.datas.consumerinfo != null) obj = data.value.datas.consumerinfo;
		    				if(data.value.datas.mplist != null && data.value.datas.mplist.length > 0) mplist = data.value.datas.mplist;
		    				if(data.value.datas.relalist != null && data.value.datas.relalist.length > 0) relalist = data.value.datas.relalist;
		    				
		    				for(var field in obj){
		    					if( $("#"+field).length && $("#"+field).length > 0 ){
		    						$("#"+field).prepend(obj[field]);
		    					}
		    				}	
		    				for(var j in mplist){
		    					var mp = mplist[j];
		    					var mptr = "";
		    					if((j+1)%2 == 0){
		    						mptr = "<tr class=\"bg-light-gray\"><td>"+mp.marketConsNo+"</td><td>"+mp.mpNo+"</td><td>"+mp.mpName+"</td><td>"+mp.meterNo+"</td><td>"+mp.meterRate + "</td><td>" + mp.meterDigits + "</td></tr>";
		    					}else{
		    						mptr = "<tr><td>"+mp.marketConsNo+"</td><td>"+mp.mpNo+"</td><td>"+mp.mpName+"</td><td>"+mp.meterNo+"</td><td>"+mp.meterRate + "</td><td>" + mp.meterDigits + "</td></tr>";
		    					}
		    					$("#mpinfo").append(mptr);
		    				}
		    				//判断是否存在关联用户信息
		    				if(relalist != null && relalist.length > 0){
		    					for(var i=0; i<relalist.length; i++){
		    						var rela = relalist[i];
		    						var relatr = "";
		    						if((i+1)%2 == 0){
		    							relatr = "<tr class=\"bg-light-gray\"><td>"+(i+1)+"</td><td>"+rela.consName +"</td><td>"+rela.voltCodeName +"</td><td>"+rela.elecTypeCodeName +"</td><td><a href='javascript:void(0)' onClick='consRelaDetail(\""+ rela.consId +"\")'>查看</a></td></tr>";
		    						}else{
		    							relatr = "<tr><td>"+(i+1)+"</td><td>"+rela.consName +"</td><td>"+rela.voltCodeName +"</td><td>"+rela.elecTypeCodeName +"</td><td><a href='javascript:void(0)' onClick='consRelaDetail(\""+ rela.consId +"\")'>查看</a></td></tr>";
		    						}
		    						$("#consrela").append(relatr);
		    					}
		    				}else{
		    					$(".consRelaMessage").hide();
		    				}
		    			}
	    			}else{
	    				MainFrameUtil.alert({title:"失败提示",body:"查询失败！"});
	    				return;
	    			}
	    		},
	    		error : function() {
	    			MainFrameUtil.alert({title:"网络失败提示",body:"请刷新页面重试！"});
	    			return;
	    		}
	    	});
	    }
	
	    //设置关联用户信息
	    function consRelaDetail(id){
	    	MainFrameUtil.openDialog({
		 		id:"cons_rela",
				params:{id:id},
				herf:"cons-rela.html",
				maximizable:false,
				width:"90%",
				height:620,
		  	  });
	    }
    </script>
	</body>
</html>
